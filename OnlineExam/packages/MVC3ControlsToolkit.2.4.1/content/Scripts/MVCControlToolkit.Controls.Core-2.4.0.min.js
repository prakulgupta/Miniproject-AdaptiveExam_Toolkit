/* ****************************************************************************
* MVCControlToolkit.Controls.Core-2.4.0.js
* Copyright (c) Francesco Abbruzzese. All rights reserved.
* francesco@dotnet-programming.com
* http://www.dotnet-programming.com/
* 
* This software is subject to the the license at http://mvccontrolstoolkit.codeplex.com/license  
* and included in the license.txt file of this distribution.
* 
* You must not remove this notice, or any other, from this software.
*
* ***************************************************************************/
Array.prototype.remove = function (c, b) { var a = this.slice((b || c) + 1 || this.length); this.length = c < 0 ? this.length + c : c; return this.push.apply(this, a) }; function MvcControlsToolkit_Trim(a) { return a.replace(/^\s+|\s+$/g, "") } function MvcControlsToolkit_DateTimeToDate(a) { if (!a) { return a } if (a.getTime() > new Date(a.getFullYear(), a.getMonth(), a.getDate(), 11, 59, 59, 999).getTime()) { a.setDate(a.getDate() + 1) } a.setHours(0); a.setMinutes(0); a.setSeconds(0); a.setMilliseconds(0); return a } function GlobalEvalScriptInElementId(d) { var c = ""; if (d.tagName == "SCRIPT") { c = d.text } else { var a = $(d).find("script"); for (var b = 0; b < a.length; b++) { c += a[b].text } } jQuery.globalEval(c) } function GlobalEvalScriptAndDestroy(b) { var a = CollectScriptAndDestroy(b); jQuery.globalEval(a) } function CollectScriptAndDestroy(d) { var c = ""; if (d.tagName == "SCRIPT") { c = d.text; $(d).remove() } else { var a = $(d).find("script"); for (var b = 0; b < a.length; b++) { c += a[b].text } a.remove() } return c } function GlobalEvalScriptInElementIdById(d) { var a = $("#" + d).find("script"); var c = ""; for (var b = 0; b < a.length; b++) { c += a[b].text } jQuery.globalEval(c) } function CollectAllScriptsInelement(d) { var a = $("#" + d).find("script"); var c = ""; for (var b = 0; b < a.length; b++) { c += a[b].text } return c } (function (g) { var h = /^[\],:{}\s]*$/; var m = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g; var l = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g; var d = /(?:^|:|,)(?:\s*\[)+/g; var a = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:[.,]\d+)?(Z|(?:[-+]\d+)?)/i; var e = /\/Date\((\d+)(?:[-+]\d+)?\)\//i; var f = /"(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:[.,](\d+))?(Z|(?:[-+]\d+)?)"/i; var k = /"\\\/Date\((\d+)(?:[-+]\d+)?\)\\\/"/i; var j = (window.JSON && window.JSON.parse) ? true : false; var b = j && window.JSON.parse('{"x":9}', function (o, n) { return "Y" }) === "Y"; var c = function (o, p) { if (typeof (p) === "string") { if (a.test(p)) { var n = new Date(p); if (isNaN(n)) { if (p.charAt(p.length - 1) == "Z") { return new Date(p.substring(0, p.length - 1)) } else { return new Date(p + "Z") } } else { return n } } if (e.test(p)) { return new Date(parseInt(e.exec(p)[1], 10)) } } return p }; g.extend({ parseJSON: function (o) { var n = true; if (typeof o !== "string" || !o) { return null } o = g.trim(o); if (h.test(o.replace(m, "@").replace(l, "]").replace(d, ""))) { if (b || (j && n !== true)) { return window.JSON.parse(o, n === true ? c : undefined) } else { o = n === true ? o.replace(f, "new Date(parseInt('$1',10),parseInt('$2',10)-1,parseInt('$3',10),parseInt('$4',10),parseInt('$5',10),parseInt('$6',10),(function(s){return parseInt(s,10)||0;})('$7'))").replace(k, "new Date($1)") : o; return (new Function("return " + o))() } } else { g.error("Invalid JSON: " + o) } } }) })(jQuery); function MvcControlsToolkit_RefreshWidget(b) { jElement = $(b); var a = jElement.attr("data-refresh") || ""; if (a == "") { return } try { $(b)[a]("refresh") } catch (c) { } } var ValidationType_StandardClient = "StandardClient"; var ValidationType_UnobtrusiveClient = "UnobtrusiveClient"; var ValidationType_Server = "Server"; function MvcControlsToolkit_Validate(g, b) { if (b == ValidationType_StandardClient) { if (typeof document.getElementById(g)[MvcControlsToolkit_FieldContext_Tag] === "undefined") { return true } var f = null; try { f = document.getElementById(g)[MvcControlsToolkit_FieldContext_Tag].validate("blur") } catch (d) { } if (f && f.length) { return false } else { return true } } else { if (b == ValidationType_UnobtrusiveClient) { var a = "#" + g; var c = true; try { c = $(a).parents("form").validate().element(a) } catch (d) { } return c } } return true } function MvcControlsToolkit_FormIsValid(d, a) { if (a == ValidationType_StandardClient) { var b = null; $("#" + d).parents("form").each(function (e) { b = this[MvcControlsToolkit_FieldContext_formValidationTag] }); if (b == null) { return true } var c = b.validate("submit"); if (c && c.length) { return false } else { return true } } else { if (a == ValidationType_UnobtrusiveClient) { return $("#" + d).parents("form").validate().form() } else { return true } } } var MvcControlsToolkit_FieldContext_hasValidationFiredTag = "__MVC_HasValidationFired"; var MvcControlsToolkit_FieldContext_formValidationTag = "__MVC_FormValidation"; var MvcControlsToolkit_FieldContext_Tag = "__MVC_FieldContext"; var MvcControlsToolkit_SpecialFormName = "_Template_Data_"; function MvcControlsToolkit_FormContext$_isElementInHierarchy(a, b) { if (b == null) { return false } while (b) { if (a === b) { return true } b = b.parentNode } return false } function MvcControlsToolkit_FieldContext$validate(a) { if (typeof Sys === "undefined" || Sys === null || typeof Sys.Mvc === "undefined" || Sys.Mvc === null || typeof Sys.Mvc.FormContext === "undefined" || Sys.Mvc.FormContext === null) { return } for (var b = 0; b < this.elements.length; b++) { if (!MvcControlsToolkit_FormContext$_isElementInHierarchy(document.body, this.elements[b])) { this.clearErrors(); return [] } } return this.baseValidate(a) } function MvcControlsToolkit_FieldContext$enableDynamicValidation() { for (var b = 0; b < this.elements.length; b++) { var a = this.elements[b]; a[MvcControlsToolkit_FieldContext_Tag] = this } this.baseEnableDynamicValidation() } if (typeof Sys !== "undefined" && Sys !== null && typeof Sys.Mvc !== "undefined" && Sys.Mvc !== null && typeof Sys.Mvc.FormContext !== "undefined" && Sys.Mvc.FormContext !== null) { Sys.Mvc.FieldContext.prototype.baseValidate = Sys.Mvc.FieldContext.prototype.validate; Sys.Mvc.FieldContext.prototype.validate = MvcControlsToolkit_FieldContext$validate; Sys.Mvc.FieldContext.prototype.baseEnableDynamicValidation = Sys.Mvc.FieldContext.prototype.enableDynamicValidation; Sys.Mvc.FieldContext.prototype.enableDynamicValidation = MvcControlsToolkit_FieldContext$enableDynamicValidation; Sys.Mvc.FieldContext.prototype._dependsOn = new Array(); Sys.Mvc.FieldContext.prototype._dependencyOnBlur = function (a) { this.validate("blur") }; Sys.Mvc.FieldContext.prototype.takeDynamicValue = function (k) { var e = null; if (this.elements.length > 0) { e = this.elements[0] } if (e == null) { return null } var b = e.name; var f = b.lastIndexOf("."); if (f >= 0) { var h = b.substring(f + 1); var c = e.id; c = c.substring(0, c.lastIndexOf(h)); k = c + k } var d = document.getElementById(k); if (d == null) { return null } var g = false; if (this._dependsOn == null) { this._dependsOn = new Array(); this._dependsOn[k] = d; g = true } else { if (typeof this._dependsOn[k] === "undefined") { this._dependsOn[k] = d; g = true } } if (g) { var a = $(e); var j = function () { if (a.attr("data-elementispart")) { var l = $("#" + e.id + "_hidden"); a.trigger("pfocus"); a.trigger("pblur"); l.trigger("pfocus"); l.trigger("pblur") } else { this.validate("blur") } }; Sys.UI.DomEvent.addHandler(d, "blur", Function.createDelegate(this, j)); $(d).bind("vblur", j) } return d.value }; Sys.Mvc.ValidatorRegistry.validators.dynamicrange = function (c) { var a = c.ValidationParameters.min; var b = c.ValidationParameters.max; return function (f, e) { if (!f || !f.length) { return true } var d = Number.parseLocale(f); if (!isNaN(d) && (a == null || a <= d) && (b == null || d <= b)) { return true } return c.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.clientdynamirange = function (d) { var c = d.ValidationParameters.min; var e = d.ValidationParameters.max; var a = d.ValidationParameters.mindelay; var b = d.ValidationParameters.maxdelay; return function (l, g) { if (!l || !l.length) { return true } var f = Number.parseLocale(l); var k = null; var m = null; if (c != null) { var h = g.fieldContext.takeDynamicValue(c); if (h != null) { k = Number.parseLocale(h); if (isNaN(k)) { k = null } else { if (a != null) { k = k + a } } } } if (e != null) { var j = g.fieldContext.takeDynamicValue(e); if (j != null) { m = Number.parseLocale(j); if (isNaN(m)) { m = null } else { if (b != null) { m = m + b } } } } if (!isNaN(f) && (k == null || k <= f) && (m == null || f <= m)) { return true } return d.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.globalizeddate = function (a) { return function (d, c) { if (!d || !d.length) { return true } var b = Date.parseLocale(d); if (b != null && !isNaN(b)) { return true } return a.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.daterange = function (rule) { var sminValue = rule.ValidationParameters.min; var smaxValue = rule.ValidationParameters.max; var minValue = null; var maxValue = null; if (sminValue != null) { sminValue = "new " + sminValue.substring(1, sminValue.length - 1); minValue = eval(sminValue) } if (smaxValue != null) { smaxValue = "new " + smaxValue.substring(1, smaxValue.length - 1); maxValue = eval(smaxValue) } return function (value, context) { if (!value || !value.length) { return true } var convertedValue = Date.parseLocale(value); if (convertedValue != null && (minValue == null || minValue <= convertedValue) && (maxValue == null || convertedValue <= maxValue)) { return true } return rule.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.clientdynamicdaterange = function (f) { var e = f.ValidationParameters.min; var g = f.ValidationParameters.max; var a = f.ValidationParameters.mindelay; var b = f.ValidationParameters.maxdelay; var c = null; var d = null; return function (m, j) { if (!m || !m.length) { return true } var h = Date.parseLocale(m); if (e != null) { var k = j.fieldContext.takeDynamicValue(e); if (k != null) { c = Date.parseLocale(k); if (a != null) { c = new Date(c.getTime() + a) } } } if (g != null) { var l = j.fieldContext.takeDynamicValue(g); if (l != null) { d = Date.parseLocale(l); if (b != null) { d = new Date(d.getTime() + b) } } } if (h != null && (c == null || c <= h) && (d == null || h <= d)) { return true } return f.ErrorMessage } } } if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { (function (a) { a.validator.takeDynamicValue = function (f, m) { if (f == null) { return null } var c = f.name; var g = c.lastIndexOf("."); if (g >= 0) { var j = c.substring(g + 1); var d = f.id; d = d.substring(0, d.lastIndexOf(j)); m = d + m } var e = document.getElementById(m); if (e == null) { return null } var h = false; var l = jQuery.data(f, "_dependsOn"); if (typeof l == "undefined" || l == null) { l = new Array(); l[m] = e; jQuery.data(f, "_dependsOn", l); h = true } else { if (typeof l[m] === "undefined") { l[m] = e; h = true } } if (h) { var b = a(f); var k = function () { if (b.attr("data-elementispart")) { var n = a("#" + f.id + "_hidden"); b.trigger("pfocus"); b.trigger("pblur"); n.trigger("pfocus"); n.trigger("pblur") } else { b.parents("form").first().validate().element(f) } }; a(e).blur(k); a(e).bind("vblur", k) } if (a(e).attr("data-element-type") == "native") { return MvcControlsToolkit_native_GetString(e, true) } return e.value }; a.validator.unobtrusive.clearAndParse = function (b) { var c = a(b).parents("form"); if (c.length != 0) { c.removeData("validator") } else { a(b).removeData("validator") } a.validator.unobtrusive.parse(b) }; a.validator.unobtrusive.reParse = function (b) { a.validator.unobtrusive.clearAndParse(b); MvcControlsToolkit_ParseRegister.parse(b) }; a.validator.unobtrusive.parseExt = function (b) { a.validator.unobtrusive.parse(b); var e = a(b).first().closest("form"); var d = e.data("unobtrusiveValidation"); if (!d) { return } var c = e.validate(); a.each(d.options.rules, function (g, f) { if (c.settings.rules[g] == undefined) { var h = {}; a.extend(h, f); h.messages = d.options.messages[g]; a('[name= "' + g + '"]').rules("add", h) } else { a.each(f, function (l, k) { if (c.settings.rules[g][l] == undefined) { var j = {}; j[l] = k; j.messages = d.options.messages[g][l]; a('[name= "' + g + '"]').rules("add", j) } }) } }); MvcControlsToolkit_ParseRegister.parse(b) } })($); $.validator.unobtrusive.adapters.addBool("mandatory", "required"); $.validator.addMethod("dynamicrange", function (d, b, f) { var c = f[0]; if (c == "") { c = null } var e = f[1]; if (e == "") { e = null } if ((!d || !d.length) && this.optional(b)) { return true } if ($(b).attr("data-element-type") == "native") { d = MvcControlsToolkit_native_GetString(b, true) } var a = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { a = jQuery.global.parseFloat(d) } else { a = parseFloat(d) } if (!isNaN(a) && (c == null || c <= a) && (e == null || a <= e)) { return true } return false }, "value is not in the required range"); jQuery.validator.unobtrusive.adapters.add("dynamicrange", ["min", "max"], function (b) { var c = b.params.min, a = b.params.max; b.rules.dynamicrange = [c, a]; if (b.message) { b.messages.dynamicrange = b.message } }); $.validator.addMethod("clientdynamirange", function (m, h, e) { var f = e[0]; if (f == "") { f = null } var a = e[2]; if (a == "") { a = null } var g = e[1]; if (g == "") { g = null } var c = e[3]; if (c == "") { c = null } var l = null; var k = null; if (g != null) { g = parseFloat(g) } if (c != null) { c = parseFloat(c) } if ((!m || !m.length) && this.optional(h)) { return true } if ($(h).attr("data-element-type") == "native") { m = MvcControlsToolkit_native_GetString(h, true) } var b = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { b = jQuery.global.parseFloat(m) } else { b = parseFloat(m) } if (f != null) { var j = $.validator.takeDynamicValue(h, f); if (j != null) { l = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { l = jQuery.global.parseFloat(j) } else { l = parseFloat(j) } if (isNaN(l)) { l = null } else { if (g != null) { l = l + g } } } } if (a != null) { var d = $.validator.takeDynamicValue(h, a); if (d != null) { k = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { k = jQuery.global.parseFloat(d) } else { k = parseFloat(d) } if (isNaN(k)) { k = null } else { if (c != null) { k = k + c } } } } if (!isNaN(b) && (l == null || l <= b) && (k == null || b <= k)) { return true } return false }, "value is not in the required range"); jQuery.validator.unobtrusive.adapters.add("clientdynamirange", ["min", "mindelay", "max", "maxdelay"], function (a) { var b = a.params.min, c = a.params.mindelay; max = a.params.max, maxdelay = a.params.maxdelay; a.rules.clientdynamirange = [b, c, max, maxdelay]; if (a.message) { a.messages.clientdynamirange = a.message } }); $.validator.addMethod("globalizeddate", function (c, b, d) { if ((!c || !c.length) && this.optional(b)) { return true } if ($(b).attr("data-element-type") == "native") { c = MvcControlsToolkit_native_GetString(b, true) } var a = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { a = new Date(c); a = jQuery.global.parseDate(c) } else { a = new Date(c) } return !isNaN(a) && a != null }, "field must be a date/time"); $.validator.addMethod("daterange", function (value, element, param) { var minValue = param[0]; if (minValue == "") { minValue = null } var maxValue = param[1]; if (maxValue == "") { maxValue = null } if (minValue != null) { minValue = (minValue + "").charAt(0) == "/" ? eval("new " + minValue.substring(1, minValue.length - 1)) : new Date(minValue) } if (maxValue != null) { maxValue = (maxValue + "").charAt(0) == "/" ? eval("new " + maxValue.substring(1, maxValue.length - 1)) : new Date(maxValue) } if ((!value || !value.length) && this.optional(element)) { return true } if ($(element).attr("data-element-type") == "native") { value = MvcControlsToolkit_native_GetString(element, true) } var convertedValue = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { convertedValue = new Date(value); convertedValue = jQuery.global.parseDate(value) } else { convertedValue = new Date(value) } if (!isNaN(convertedValue) && (minValue == null || minValue <= convertedValue) && (maxValue == null || convertedValue <= maxValue)) { return true } return false }, "date is not in the required range"); jQuery.validator.unobtrusive.adapters.add("daterange", ["min", "max"], function (b) { var c = b.params.min, a = b.params.max; b.rules.daterange = [c, a]; if (b.message) { b.messages.daterange = b.message } }); $.validator.addMethod("clientdynamicdaterange", function (m, h, e) { var f = e[0]; if (f == "") { f = null } var a = e[2]; if (a == "") { a = null } var g = e[1]; if (g == "") { g = null } var c = e[3]; if (c == "") { c = null } var l = null; var k = null; if (g != null) { g = parseInt(g) } if (c != null) { c = parseInt(c) } if ((!m || !m.length) && this.optional(h)) { return true } if ($(h).attr("data-element-type") == "native") { m = MvcControlsToolkit_native_GetString(h, true) } var b = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { b = jQuery.global.parseDate(m) } else { b = parseDate(m) } if (f != null) { var j = $.validator.takeDynamicValue(h, f); if (j != null) { l = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { l = jQuery.global.parseDate(j) } else { l = parseDate(j) } if (isNaN(l)) { l = null } else { if (g != null) { l = new Date(l.getTime() + g) } } } } if (a != null) { var d = $.validator.takeDynamicValue(h, a); if (d != null) { k = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { k = jQuery.global.parseDate(d) } else { k = parseDate(d) } if (isNaN(k)) { k = null } else { if (c != null) { k = new Date(k.getTime() + c) } } } } if (!isNaN(b) && (l == null || l <= b) && (k == null || b <= k)) { return true } return false }, "date is not in the required range"); jQuery.validator.unobtrusive.adapters.add("clientdynamicdaterange", ["min", "mindelay", "max", "maxdelay"], function (a) { var b = a.params.min, c = a.params.mindelay; max = a.params.max, maxdelay = a.params.maxdelay; a.rules.clientdynamicdaterange = [b, c, max, maxdelay]; if (a.message) { a.messages.clientdynamicdaterange = a.message } }); jQuery.validator.unobtrusive.adapters.add("globalizeddate", [], function (a) { a.rules.globalizeddate = []; if (a.message) { a.messages.globalizeddate = a.message } }) } function Setup_Ajax_ClientValidation(d, a) { if (a == ValidationType_StandardClient) { var e = window.mvcClientValidationMetadata; if (e) { for (var b = 0; b < e.length; b++) { var c = e[b]; c.FormId = d } } Sys.Mvc.FormContext._Application_Load() } else { if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { $.validator.unobtrusive.clearAndParse("#" + d) } } MvcControlsToolkit_ParseRegister.parse("#" + d) } var DualSelect_Separator = ";;;"; var DualSelect_SelectAvial = "_AvialSelect"; var DualSelect_SelectSelected = "_SelSelect"; var DualSelect_HiddenSelectedItemsVal = ""; var DualSelect_Postfix = "___PackedValue"; var DualSelect_AvailableFilter = "_AvailableFilter"; var DualSelect_SelectedFilter = "_SelectedFilter"; var DualSelect_TempObjSource, DualSelect_TempObjDestination; function MvcControlsToolkit_SubstringRating(h, a) { h = h.toLowerCase(); a = a.toLowerCase(); var c = -true; var b = 0; var f = 0; for (var e = 0; e < h.length; e++) { if (a == "") { return [f, b] } var g = h.charAt(e); var d = a.indexOf(g); if (d == -1) { continue } f++; if (c) { b += d; c = false } else { b += d * 1000 } if (d + 1 < a.length) { a = a.substr(d + 1) } else { a = "" } } return [f, b] } function DualSelect_FilterInit(b, a) { $("#" + b + (a ? DualSelect_SelectedFilter : DualSelect_AvailableFilter)).keydown(function () { var c = this; var d = MvcControlsToolkit_Trim($(c).val()); setTimeout(function () { var h = document.getElementById(b + (a ? DualSelect_SelectSelected : DualSelect_SelectAvial)); var e = MvcControlsToolkit_Trim($(c).val()); if (d == e) { return } d = e; if (e == "") { return } var g = []; for (var f = 0; f < h.length; f++) { g.push({ rating: MvcControlsToolkit_SubstringRating(e, $(h[f]).text()), item: h[f] }) } g.sort(function (k, j) { if (k.rating[0] > j.rating[0]) { return -1 } if (j.rating[0] > k.rating[0]) { return 1 } if (k.rating[1] < j.rating[1]) { return -1 } if (j.rating[1] < k.rating[1]) { return 1 } return 0 }); h.options.length = 0; for (var f = 0; f < g.length; f++) { h.options.add(g[f].item) } if (a) { DualSelect_SaveSelection(b) } }) }) } function DualSelect_SetObjects(b, a) { if (a) { DualSelect_TempObjSource = document.getElementById(b + DualSelect_SelectAvial); DualSelect_TempObjDestination = document.getElementById(b + DualSelect_SelectSelected) } else { DualSelect_TempObjSource = document.getElementById(b + DualSelect_SelectSelected); DualSelect_TempObjDestination = document.getElementById(b + DualSelect_SelectAvial) } } function DualSelect_GetIndexForInsert(b, c) { if (b.autosort == "false") { return b.length + 1 } if (b.length == 0) { return 0 } for (var a = 0; a < b.length; a++) { if (b[a].text > c.text) { return a } } return b.length } function DualSelect_MoveElement(e, c) { DualSelect_SetObjects(e, c); var a = $("#" + e.substring(0, e.lastIndexOf("___"))); if (DualSelect_TempObjSource.length == 0) { return } iLast = 0; for (var d = 0; d < DualSelect_TempObjSource.length; d++) { if (DualSelect_TempObjSource[d].selected) { iLast = d; var f = DualSelect_TempObjSource[d]; var b = new MvcControlsToolkit_changeData(f, c ? "ItemCreating" : "ItemDeleting", 0); a.trigger("itemChange", b); if (b.Cancel == true) { continue } DualSelect_TempObjSource.remove(d); nPos = (DualSelect_TempObjDestination.length + 1); DualSelect_TempObjDestination.options.add(f, DualSelect_GetIndexForInsert(DualSelect_TempObjDestination, f)); b = new MvcControlsToolkit_changeData(f, c ? "ItemCreated" : "ItemDeleted", 0); a.trigger("itemChange", b); d-- } } DualSelect_SaveSelection(e); if (DualSelect_TempObjSource.length > 0 && iLast == 0) { DualSelect_TempObjSource.selectedIndex = 0 } else { if (DualSelect_TempObjSource.length - 1 >= iLast) { DualSelect_TempObjSource.selectedIndex = iLast } else { if (DualSelect_TempObjSource.length >= 1) { DualSelect_TempObjSource.selectedIndex = iLast - 1 } } } DualSelect_ClearSelection(DualSelect_TempObjSource); DualSelect_TempObjSource.focus; a.trigger("DualSelect_Changed") } function DualSelect_Move_Up(g, c) { DualSelect_SetObjects(g, c); var a = $("#" + g.substring(0, g.lastIndexOf("___"))); if (DualSelect_TempObjSource.length == 0) { return } if (DualSelect_TempObjSource[0].selected) { return } for (var d = 1; d < DualSelect_TempObjSource.length; d++) { if (DualSelect_TempObjSource[d].selected) { var f = DualSelect_TempObjSource[d]; var b = new MvcControlsToolkit_changeData(f, "ItemMoving", 1); a.trigger("itemChange", b); if (b.Cancel == true) { continue } var e = DualSelect_TempObjSource[d - 1]; DualSelect_TempObjSource.remove(d); DualSelect_TempObjSource.remove(d - 1); DualSelect_TempObjSource.options.add(f, d - 1); DualSelect_TempObjSource.options.add(e, d); b = new MvcControlsToolkit_changeData(f, "ItemMoved", 1); a.trigger("itemChange", b); d-- } } DualSelect_SaveSelection(g); a.trigger("DualSelect_Changed") } function DualSelect_Move_Down(g, c) { DualSelect_SetObjects(g, c); var a = $("#" + g.substring(0, g.lastIndexOf("___"))); if (DualSelect_TempObjSource.length == 0) { return } if (DualSelect_TempObjSource[DualSelect_TempObjSource.length - 1].selected) { return } for (var d = DualSelect_TempObjSource.length - 2; d > -1; d--) { if (DualSelect_TempObjSource[d].selected) { var f = DualSelect_TempObjSource[d]; var b = new MvcControlsToolkit_changeData(f, "ItemMoving", -1); a.trigger("itemChange", b); if (b.Cancel == true) { continue } var e = DualSelect_TempObjSource[d + 1]; DualSelect_TempObjSource.remove(d + 1); DualSelect_TempObjSource.remove(d); DualSelect_TempObjSource.options.add(e, d); DualSelect_TempObjSource.options.add(f, d + 1); b = new MvcControlsToolkit_changeData(f, "ItemMoved", -1); a.trigger("itemChange", b); d++ } } DualSelect_SaveSelection(g); a.trigger("DualSelect_Changed") } function DualSelect_MoveAll(e, d, b) { DualSelect_SetObjects(e, d); var a = $("#" + e.substring(0, e.lastIndexOf("___"))); var f = 0; while (DualSelect_TempObjSource.length > f) { oNode = DualSelect_TempObjSource[f]; if (b != true) { var c = new MvcControlsToolkit_changeData(oNode, d ? "ItemCreating" : "ItemDeleting", 0); a.trigger("itemChange", c); if (c.Cancel == true) { f++; continue } } DualSelect_TempObjSource.remove(oNode); DualSelect_TempObjDestination.options.add(oNode, DualSelect_GetIndexForInsert(DualSelect_TempObjDestination, oNode)); if (b != true) { var c = new MvcControlsToolkit_changeData(oNode, d ? "ItemCreated" : "ItemDeleted", 0); a.trigger("itemChange", c) } } DualSelect_SaveSelection(e); if (b != true) { a.trigger("DualSelect_Changed") } } function DualSelect_ClearSelection(b) { for (var a = 0; a < b.length; a++) { b[a].selected = false } } function DualSelect_SaveSelection(d) { var b = document.getElementById(d + DualSelect_SelectSelected); var c = ""; var e = ""; for (var a = 0; a < b.length; a++) { c += b[a].value + DualSelect_Separator } document.getElementById(d + DualSelect_HiddenSelectedItemsVal).value = c } function MvcControlsToolkit_DualSelect_Set(o, a, h, f) { var c = document.getElementById(o.id + DualSelect_Postfix + DualSelect_SelectAvial); var p = document.getElementById(o.id + DualSelect_Postfix + DualSelect_SelectSelected); if (c == null || p == null) { setTimeout(function () { MvcControlsToolkit_DualSelect_Set(o, a, h, f) }, 0); return } var g = $(o).attr("data-item-type"); if (g) { g = parseInt(g) } f = g || f; DualSelect_MoveAll(o.id + DualSelect_Postfix, false, true); if (a instanceof Array && c.options.length > 0) { var t = new Array(); for (var m = 0, k = c.length; m < k; m++) { t.push(MvcControlsToolkit_Parse(c.options[m].value, f)); c.options[m].selected = false } for (var m = 0, b = a.length; m < b; m++) { if (f == MvcControlsToolkit_DataType_Float) { var e = 0; var s = Math.abs(a[m] - t[0]); for (var k = 1, d = t.length; k < d; k++) { if (Math.abs(t[k] - a[m]) < s) { e = k; s = Math.abs(t[k] - a[m]) } } if (e >= 0) { var q = c.options[e]; c.options.remove(e); t.remove(e); p.options.add(q) } } else { for (var k = 0, d = t.length; k < d; k++) { if (t[k] === a[m]) { var q = c.options[k]; c.options.remove(k); t.remove(k); p.options.add(q); break } } } } DualSelect_SaveSelection(o.id + DualSelect_Postfix) } } function MvcControlsToolkit_DualSelect_SetString(a, b) { MvcControlsToolkit_DualSelect_Set(a, b, null, MvcControlsToolkit_DataType_String) } function MvcControlsToolkit_DualSelect_Get(c, g) { var f = $(c).attr("data-item-type"); if (f) { f = parseInt(f) } g = f || g; var d = document.getElementById(c.id + DualSelect_Postfix + DualSelect_SelectSelected); if (d == null) { setTimeout(function () { MvcControlsToolkit_DualSelect_Get(c, g) }, 0); return } var e = new Array(); for (var b = 0, a = d.length; b < a; b++) { e.push(MvcControlsToolkit_Parse(d.options[b].value, g)) } return e } function MvcControlsToolkit_DualSelect_GetString(a) { return MvcControlsToolkit_DualSelect_Get(a, MvcControlsToolkit_DataType_String) } function MvcControlsToolkit_changeData(b, a, c) { this.ItemChanged = b; this.ChangeType = a; this.Data = c } MvcControlsToolkit_changeData.prototype = { ItemChanged: null, ChangeType: null, Data: null, Cancel: false }; var ManipulationButtonRemove = "ManipulationButtonRemove"; var ManipulationButtonHide = "ManipulationButtonHide"; var ManipulationButtonShow = "ManipulationButtonShow"; var ManipulationButtonResetGrid = "ManipulationButtonResetGrid"; var ManipulationButtonCustom = "ManipulationButtonCustom"; function ManipulationButton_Click(target, dataButtonType) { if (dataButtonType == ManipulationButtonCustom) { if (typeof target === "string") { eval(target) } else { target() } return } if (dataButtonType == ManipulationButtonRemove) { $("#" + target).remove() } else { if (dataButtonType == ManipulationButtonHide) { $("#" + target).css("visibility", "hidden") } else { if (dataButtonType == ManipulationButtonShow) { $("#" + target).css("visibility", "visible") } else { if (dataButtonType == ManipulationButtonResetGrid) { var toUndo = eval(target + AllNormalPostfix); if (toUndo != null) { for (var i = 0; i < toUndo.length; i++) { var vChanged = toUndo[i].substring(0, toUndo[i].lastIndexOf("_")) + ChandedPostfix; var deleted = eval(toUndo[i] + DeletedPostFix); if (deleted != null && deleted == true) { DataButton_Click(toUndo[i], vChanged, DataButtonUndelete) } else { DataButton_Click(toUndo[i], vChanged, DataButtonCancel) } } } } } } } } function MvcControlsToolkit_Button_AdjustText(a, c) { var b = document.getElementById(a); var d = b.nodeName.toLowerCase(); if (d == "input") { b.value = c } else { if (d == "img") { b.setAttribute("src", c) } else { if (d == "a") { b.firstChild.nodeValue = c } } } } function PageButton_Click(d, c, e, b, a) { if (e == "") { if (!MvcControlsToolkit_FormIsValid(d, a)) { return } var f = document.getElementById(d); f.value = c; $("#" + d).parents("form").submit() } else { if (b != "") { $.ajax({ type: "GET", url: e, success: function (g) { $("#" + b).html(g) } }) } else { window.location.href = e } } } function MvcControlsToolkit_RefreshPager(d) { var c = function (h, l) { if (!l || l == "curr") { if (l == "curr") { h.attr("data-selected-page", "selected") } else { h.attr("disabled", "disabled"); if (h[0].tagName.toLowerCase() == "img") { var j = h.attr("data-enabled-src") || ""; if (j != "") { h.attr("src") = j } } } h.attr("data-no-click", true) } else { h.removeAttr("disabled"); h.removeAttr("data-selected-page"); if (h[0].tagName.toLowerCase() == "img") { var k = h.attr("data-disabled-src") || ""; if (k != "") { h.attr("src") = k } } h.removeAttr("data-no-click") } }; var b = $("#" + d); var a = parseInt(b.val()); var f = b.attr("data-total-pages") || ""; if (f != "") { f = parseInt(f) } if (a < 1) { a = 1 } var e = b.attr("data-page-prefix") || ""; var g = b.attr("data-page-postfix") || ""; MvcControlsToolkit_TypedTextBox_SetById(d + "_goto", a, null, 1); $("." + d + "_class").each(function () { var k = $(this); var j = k.attr("data-pager-button"); if (j == "PageButtonFirst" || j == "PageButtonPrevious") { if (a == 1) { c(k, false) } else { c(k, true) } } else { if (j == "PageButtonNext") { if (f != "" && a >= f) { c(k, false) } else { c(k, true) } } else { if (j == "PageButtonLast") { if (f == "" || a >= f) { c(k, false) } else { c(k, true) } } else { if (j == "PageButtonPage") { var h = parseInt(k.attr("data-pager-index")); if (a + h < 1 || (f != "" && a + h > f)) { k.parent().hide() } else { k.text(e + (a + h) + g); k.parent().show(); if (h == 0) { c(k, "curr") } else { c(k, true) } } } } } } b.trigger("pagerRefreshed") }) } function MvcControlsToolkit_InitJsonPager(pagerId) { $(document).ready(function () { var pager = $("#" + pagerId); var causeSubmit = (pager.attr("data-cause-submit") || "") != ""; var validationType = pager.attr("data-validation-type") || ""; $("." + pagerId + "_class").click(function () { var jThis = $(this); if ((jThis.attr("data-no-click") || false)) { return false } var type = jThis.attr("data-pager-button"); var prevPage = pager.val(); if (!causeSubmit || MvcControlsToolkit_FormIsValid(pagerId, validationType)) { if (type == "PageButtonFirst") { pager.val(1); pager.trigger("ClientPager_Changed") } else { if (type == "PageButtonPrevious") { var currPage = parseInt(pager.val()); pager.val(currPage - 1); pager.trigger("ClientPager_Changed") } else { if (type == "PageButtonNext") { var currPage = parseInt(pager.val()); pager.val(currPage + 1); pager.trigger("ClientPager_Changed") } else { if (type == "PageButtonLast") { var totPages = pager.attr("data-total-pages") || ""; if (totPages != "") { pager.val(parseInt(totPages)); pager.trigger("ClientPager_Changed") } } else { if (type == "PageButtonPage") { var currPage = parseInt(pager.val()); var index = parseInt(jThis.attr("data-pager-index")); pager.val(currPage + index); pager.trigger("ClientPager_Changed") } else { if (type == "PageButtonGoTo") { var totPages = pager.attr("data-total-pages") || ""; if (totPages != "") { totPages = parseInt(totPages) } var targetPage = MvcControlsToolkit_TypedTextBox_GetById(pagerId + "_goto", 1); if (targetPage < 1) { targetPage = 1 } else { if (totPages != "" && targetPage > totPages) { targetPage = totPages } } pager.val(targetPage); pager.trigger("ClientPager_Changed") } } } } } } } MvcControlsToolkit_RefreshPager(pagerId); var totPages = pager.attr("data-total-pages") || ""; if (totPages != "") { totPages = parseInt(totPages) } var data = { type: "page", submit: causeSubmit, page: parseInt(pager.val()), pager: pager, previousPage: parseInt(prevPage), totalPages: totPages }; var clientModel = pager.attr("data-client-model") || ""; var pageSizeName = pager.attr("data-page-size") || ""; var pageSizeId = pager.attr("data-page-size-id"); if (clientModel != "" && pageSizeName != "") { data.pageSizeObservable = eval(clientModel + "." + pageSizeName); data.itemsPerPage = ko.utils.unwrapObservable(data.pageSizeObservable) } else { if (pageSizeId) { data.itemsPerPage = MvcControlsToolkit_TypedTextBox_GetById(pageSizeId, MvcControlsToolkit_DataType_Int); if (isNaN(data.itemsPerPage)) { data.itemsPerPage = null } } } pager.trigger("queryChanged", data); if (data.submit) { pager.parents("form").first().submit() } }); var clientModel = pager.attr("data-client-model") || ""; var totalPageName = pager.attr("data-total-pages-name") || ""; if (clientModel != "" && totalPageName != "") { var dependentObservable = new ko.dependentObservable(function () { var pages = ko.utils.unwrapObservable(eval(clientModel + "." + totalPageName)); var page = parseInt(pager.val()); if (page > pages) { page = pages; if (page == 0) { page = 1 } pager.val(page); pager.trigger("ClientPager_Changed") } pager.attr("data-total-pages", pages + ""); MvcControlsToolkit_RefreshPager(pagerId) }, null, { disposeWhenNodeIsRemoved: pager[0] }); pager.data("__mvcct_totalpagesDependency__", dependentObservable) } MvcControlsToolkit_RefreshPager(pagerId) }) } function MvcControlsToolkit_NewPage(c, d, b) { var a = $("#" + c); a.val(d); a.attr("data-total-pages", b); MvcControlsToolkit_RefreshPager(c) } function MvcControlsToolkit_ClientPager_Get(a, b) { return parseInt($(a).val()) } function MvcControlsToolkit_ClientPager_GetString(a) { return $(a).val() } function MvcControlsToolkit_ClientPager_GetById(b, a) { return parseInt($("#" + b).val()) } function MvcControlsToolkit_ClientPager_Set(b, a, c, d) { $(b).val(a); MvcControlsToolkit_RefreshPager(b.id) } function MvcControlsToolkit_ClientPager_SetById(d, a, b, c) { $("#" + d).val(a); MvcControlsToolkit_RefreshPager(d) } function MvcControlsToolkit_ClientPager_SetString(b, a) { $(b).val(a); MvcControlsToolkit_RefreshPager(b.id) } function MvcControlsToolkit_ClientPager_BindChange(b, a) { $("#" + b).bind("ClientPager_Changed", a) } function MvcControlsToolkit_ClientPager_UnbindChange(b, a) { $("#" + b).unbind("ClientPager_Changed", a) } function _inner_Sort_Handler(field, buttonName, initialize, causePostback, clientOrderChanged, sortField, pageField, cssNoSort, cssAscending, cssDescending, validationType, oneColumnSorting) { if (!initialize && causePostback && !MvcControlsToolkit_FormIsValid(sortField, validationType)) { return } var order = $("#" + sortField).val(); var hasAscending = order.indexOf(" " + field + "#+;"); var hasDescending = order.indexOf(" " + field + "#-;"); var prevOrder = ""; var actualOrder = ""; if (!initialize) { if (hasDescending >= 0) { if (oneColumnSorting) { order = order.replace(" " + field + "#-;", " " + field + "#+;") } else { order = order.replace(" " + field + "#-;", "") } $("#" + sortField).val(order); $("#" + buttonName).removeClass(cssDescending); if (oneColumnSorting) { $("#" + buttonName).addClass(cssAscending) } else { $("#" + buttonName).addClass(cssNoSort) } prevOrder = "-" } else { if (hasAscending >= 0) { order = order.replace(" " + field + "#+;", " " + field + "#-;"); $("#" + sortField).val(order); $("#" + buttonName).removeClass(cssAscending); $("#" + buttonName).addClass(cssDescending); prevOrder = "+"; actualOrder = "-" } else { if (oneColumnSorting) { order = " " + field + "#+;" } else { order = order + " " + field + "#+;" } $("#" + sortField).val(order); $("#" + buttonName).removeClass(cssNoSort); $("#" + buttonName).addClass(cssAscending); actualOrder = "+"; if (oneColumnSorting) { var prevButton = eval(sortField); if (prevButton != "" && prevButton != buttonName) { $("#" + prevButton).removeClass(cssDescending).removeClass(cssAscending).addClass(cssNoSort) } eval(sortField + " = buttonName;") } } } if (pageField != null) { $("#" + pageField).val("1") } if (clientOrderChanged != null) { eval(clientOrderChanged + "('" + field + "', '" + prevOrder + "', '" + actualOrder + "')") } if (causePostback) { $("#" + sortField).parents("form").submit() } } else { if (hasDescending >= 0) { $("#" + buttonName).removeClass(cssDescending + " " + cssAscending + " " + cssNoSort).addClass(cssDescending); if (oneColumnSorting) { eval(sortField + " = buttonName;") } } else { if (hasAscending >= 0) { $("#" + buttonName).removeClass(cssDescending + " " + cssAscending + " " + cssNoSort).addClass(cssAscending); if (oneColumnSorting) { eval(sortField + " = buttonName;") } } else { $("#" + buttonName).removeClass(cssDescending + " " + cssAscending + " " + cssNoSort).addClass(cssNoSort) } } } } function Sort_Handler(o, s, d, g, k, l, f, h, e, j, n, m, q) { var b = $("#" + l); if (!d && g && !MvcControlsToolkit_FormIsValid(l, n)) { return } _inner_Sort_Handler(o, s, d, false, k, l, f, h, e, j, n, m); if (!d) { var c = { type: "sort", sortString: b.val(), submit: g, sorterInfos: { func: q, container: l, value: $("#" + l).val() }, page: 1 }; if (f != null) { var a = $("#" + f); MvcControlsToolkit_RefreshPager(f); a.trigger("ClientPager_Changed"); var p = a.attr("data-total-pages") || ""; if (p != "") { p = parseInt(p) } c.pageSize = p } $("#" + s).trigger("queryChanged", c); if (c.submit) { b.parents("form").first().submit() } } } function ViewList_Client(groupName, hiddenField, cssSelected, prefix) { this.CssSelected = cssSelected; this.GroupName = groupName; this.HiddenField = hiddenField; this.Prefix = prefix; var allViews = $("." + groupName); allViews.each(function (i) { var name = this.id + "_placeholder"; var thisId = this.id; $("#" + thisId).before("<span style='display:none;' id='" + name + "'></span>"); $("." + thisId + "_checkbox").click(function () { if ($("." + thisId + "_checkbox")[0].checked) { eval(groupName + "_ViewList").Select(thisId, true) } else { eval(groupName + "_ViewList").Select("", true) } }) }); this.SelectionSet = allViews.detach(); this.SelectionSet.find("script").remove() } ViewList_Client.prototype = { HiddenField: null, GroupName: null, CssSelected: null, SelectionSet: null, Prefix: null, Select: function (b, a) { $("." + this.GroupName + "_button").removeClass(this.CssSelected); $("." + this.GroupName + "_checkbox").each(function (c) { this.checked = false }); $("." + this.GroupName).detach(); if (b == "") { document.getElementById(this.HiddenField).value = ""; return } document.getElementById(this.HiddenField).value = b; if (a == null) { b = this.Prefix + b } this.SelectionSet.filter("#" + b).insertBefore("#" + b + "_placeholder"); $("." + b + "_button").addClass(this.CssSelected); $("." + b + "_checkbox").each(function (c) { this.checked = true }) } }; function ViewsOnOff_Client_Switch(groupName, on, hidden) { if (on) { $("." + groupName + "_checkbox").each(function (i) { this.checked = true }); var toAttach = eval(groupName + "_ViewsOnOff"); toAttach.each(function (i) { var currId = this.id; $(this).insertBefore("#" + currId + "_placeholder") }); document.getElementById(hidden).value = "True" } else { $("." + groupName + "_checkbox").each(function (i) { this.checked = false }); $("." + groupName).detach(); document.getElementById(hidden).value = "False" } } function ViewsOnOff_Client_Initialize(groupName, initial_on, hidden) { var allViews = $("." + groupName); allViews.each(function (i) { var prova = this.id; if (this.id == null || this.id == "") { this.id = groupName + "_el" + i } var name = this.id + "_placeholder"; var thisId = this.id; $("#" + this.id).before("<span style='display:none;' id='" + name + "'></span>"); $("." + groupName + "_checkbox").click(function (event) { ViewsOnOff_Client_Switch(groupName, event.target.checked, hidden) }) }); var selectionSet = allViews.detach(); selectionSet.find("script").remove(); eval(groupName + "_ViewsOnOff = selectionSet;"); if (initial_on) { $("." + groupName + "_checkbox").each(function (i) { this.checked = true }); selectionSet.each(function (i) { var currId = this.id; $(this).insertBefore("#" + currId + "_placeholder") }) } else { $("." + groupName + "_checkbox").each(function (i) { this.checked = false }) } } var MvcControlsToolkit_DataType_String = 0; var MvcControlsToolkit_DataType_UInt = 1; var MvcControlsToolkit_DataType_Int = 2; var MvcControlsToolkit_DataType_Float = 3; var MvcControlsToolkit_DataType_DateTime = 4; function MvcControlsToolkit_Format(c, d, a, b, e) { if (a < 0) { return c } if (c == null || c === undefined) { return "" } if (!b) { b = "" } if (!e) { e = "" } return b + MvcControlsToolkit_ToString(c, d, a) + e } function MvcControlsToolkit_FormatDisplay(d, e, b, c, f, a) { if (b < 0) { return d } if (d == null || d === "" || d === undefined) { return a } return c + MvcControlsToolkit_ToString(d, e, b) + f } function MvcControlsToolkit_ToString(b, c, a) { if (b === undefined) { return undefined } if (a == MvcControlsToolkit_DataType_String || a < 0) { if (b === true) { return "True" } if (b === false) { return "False" } return b } if (b == null) { return "" } if (c === "" || c === null || c === undefined) { if (a == MvcControlsToolkit_DataType_DateTime) { c = "d" } else { if (a == MvcControlsToolkit_DataType_Int || a == MvcControlsToolkit_DataType_UInt) { c = "d" } else { if (a == MvcControlsToolkit_DataType_Float) { c = "n" } else { return b } } } } if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.global.parseInt === "function")) { if (a == MvcControlsToolkit_DataType_DateTime && c == "s") { c = "S" } return jQuery.global.format(b, c) } else { if ((typeof Number !== "undefined") && (typeof Number.parseLocale === "function")) { if (a == MvcControlsToolkit_DataType_DateTime && c == "S") { c = "s" } return b.localeFormat(c) } else { return b + "" } } } function MvcControlsToolkit_Parse(c, b) { if (b == MvcControlsToolkit_DataType_String) { return c } if (c === undefined) { return undefined } if (c == "") { return null } if (b == MvcControlsToolkit_DataType_Float) { if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.global.parseFloat == "function")) { return jQuery.global.parseFloat(c) } else { if ((typeof Number !== "undefined") && (typeof Number.parseLocale == "function")) { return Number.parseLocale(c) } else { return parseFloat(c) } } } else { if (b == MvcControlsToolkit_DataType_DateTime) { if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.global.parseDate == "function")) { return jQuery.global.parseDate(c) } else { if ((typeof Date !== "undefined") && (typeof Date.parseLocale == "function")) { return Date.parseLocale(c) } else { return new Date(c) } } } else { if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.parseInt == "function")) { return jQuery.global.parseInt(c) } else { if (typeof Number.parseLocale == "function") { var a = Number.parseLocale(c); if (isNaN(a)) { return a } return parseInt(a + "") } else { return parseInt(c, 10) } } } } } function MvcControlsToolkit_TypedTextBox_Input(j, d, a, f, h, e, c, b) { if (f == MvcControlsToolkit_DataType_String || f == MvcControlsToolkit_DataType_DateTime || j == 0 || j == 13 || j == 9 || j == 8 || j == e.charCodeAt(0) || (j >= 48 && j <= 57)) { return true } if ((f == MvcControlsToolkit_DataType_Int || f == MvcControlsToolkit_DataType_Float) && (j == c.charCodeAt(0) || j == b.charCodeAt(0))) { var g = document.getElementById(d).value; return g.indexOf(c) < 0 && g.indexOf(b) < 0 } if (f == MvcControlsToolkit_DataType_Float && j == h.charCodeAt(0)) { var g = document.getElementById(d).value; return g.indexOf(h) < 0 } return false } function MvcControlsToolkit_FocusAtEnd(a) { var b = document.getElementById(a); if (b.setSelectionRange) { b.setSelectionRange(b.value.length, b.value.length) } else { if (this.createTextRange) { r = b.createTextRange(); r.collapse(false); r.select() } } } function MvcControlsToolkit_TypedTextBox_Focus(a, d, c) { var b = document.getElementById(a); document.getElementById(a).value = document.getElementById(d).value || ""; $(b).data("_was_focused_", true); if (c != "") { $("#" + a).removeClass(c) } } function MvcControlsToolkit_DisplayEdit_DbClick(a, b) { $("#" + b).hide(); $("#" + a).show().focus() } function MvcControlsToolkit_TypedTextBox_Init(o, n, m, l, k, j, h, g, f, e, d, c, b, a) { $(document).ready(function () { var p = $("#" + o); p.bind("pblur", function () { MvcControlsToolkit_TypedTextBox_Blur(o, n, l, f, e, d, h, g, k, j, c, m, b); return false }); p.bind("pfocus", function () { MvcControlsToolkit_TypedTextBox_Focus(o, n, m); return false }); try { p.trigger("pfocus"); MvcControlsToolkit_TypedTextBox_Blur(o, n, l, f, e, d, h, g, k, j, c, m, b, true) } catch (q) { } p.focus(function () { p.trigger("pfocus"); MvcControlsToolkit_FocusAtEnd(o); return true }); if (a != null) { p.datepicker(a) } if (a != null) { p.datepicker() } p.blur(function () { p.trigger("pblur"); return true }); p.keypress(function (s) { return MvcControlsToolkit_TypedTextBox_Input(s.which, o, n, l, k, j, h, g) }) }) } function MvcControlsToolkit_TypedTextBox_Blur(t, A, s, o, v, w, x, c, g, m, j, k, h, n) { var b = document.getElementById(t); if (b == null) { return } var a = $(b); if (!a.data("_was_focused_")) { a.trigger("pfocus") } a.removeData("_was_focused_"); var p = b.value; var q = p; if (s != MvcControlsToolkit_DataType_String && s != MvcControlsToolkit_DataType_DateTime) { p = MvcControlsToolkit_Trim(p); q = p; var f = p; f = f.replace(m, ""); tvalue = f.replace(x, ""); negative = f.indexOf(c); f = f.replace(c, ""); var z = ""; var d = ""; for (var u = 0; u < f.length; u++) { d = f.charCodeAt(u); if ((d >= 48 && d <= 57) || d == g.charCodeAt(0)) { z = z + f.charAt(u) } } f = z; if (p != "") { var l = 0; try { l = MvcControlsToolkit_Parse(f, s); if (negative >= 0) { l = l * -1 } if (!isNaN(l)) { p = MvcControlsToolkit_Format(l, w, s); if (s == MvcControlsToolkit_DataType_Float) { if (negative >= 0) { q = c + f } else { q = f } } else { q = MvcControlsToolkit_Format(l, "n0", s) } } } catch (y) { } } } if (s == MvcControlsToolkit_DataType_DateTime) { q = MvcControlsToolkit_Format(MvcControlsToolkit_Parse(q, s), w, s); p = q } document.getElementById(A).value = q; if (n == null) { MvcControlsToolkit_Validate(A, h); $("#" + A).trigger("vblur") } $("#" + t).removeClass("input-validation-error"); if ($("#" + A).hasClass("input-validation-error")) { $("#" + t).addClass("input-validation-error") } if (p == "") { if (k != "") { $("#" + t).addClass(k) } document.getElementById(t).value = j } else { document.getElementById(t).value = o + p + v } $("#" + t).trigger("TypedTextBox_Changed") } function MvcControlsToolkit_DisplayEdit_Init(p, o, n, m, l, k, j, h, g, f, e, d, c, b, a, q) { $(document).ready(function () { var s = $("#" + p); if (b != null) { s.datepicker(b) } s.bind("pblur", function (w, v) { var u = MvcControlsToolkit_DisplayEdit_Blur(p, o, n, h, g, f, k, j, m, l, e, c, a, !d && !v, q); if (v) { v.goneDisplay = u } return false }); try { s.trigger("pblur") } catch (t) { } s.blur(function () { s.trigger("pblur"); return true }); if (d == "click") { $("#" + o).click(function () { MvcControlsToolkit_DisplayEdit_DbClick(p, o); return true }) } else { if (d == "dblclick") { $("#" + o).dblclick(function () { MvcControlsToolkit_DisplayEdit_DbClick(p, o); return true }) } } $("#" + o).bind("pedit", function () { MvcControlsToolkit_DisplayEdit_DbClick(p, o); return true }); s.keypress(function (u) { return MvcControlsToolkit_TypedTextBox_Input(u.which, p, o, n, m, l, k, j) }) }) } function MvcControlsToolkit_DisplayEdit_Blur(s, A, q, n, u, v, w, b, f, k, h, g, m, y, l) { var a = document.getElementById(s); if (a == null) { return } var o = a.value; if (m == "select") { o = $(a).find("option:selected").text() } var p = o; if (q != MvcControlsToolkit_DataType_String && q != MvcControlsToolkit_DataType_DateTime) { o = MvcControlsToolkit_Trim(o); p = o; var d = o; d = d.replace(k, ""); tvalue = d.replace(w, ""); negative = d.indexOf(b); d = d.replace(b, ""); var z = ""; var c = ""; for (var t = 0; t < d.length; t++) { c = d.charCodeAt(t); if ((c >= 48 && c <= 57) || c == f.charCodeAt(0)) { z = z + d.charAt(t) } } d = z; if (o != "") { var j = 0; try { j = MvcControlsToolkit_Parse(d, q); if (negative >= 0) { j = j * -1 } if (!isNaN(j)) { o = MvcControlsToolkit_Format(j, v, q); if (q == MvcControlsToolkit_DataType_Float) { if (negative >= 0) { p = b + d } else { p = d } } else { p = MvcControlsToolkit_Format(j, "n0", q) } } } catch (x) { } } } if (q == MvcControlsToolkit_DataType_DateTime) { p = MvcControlsToolkit_Format(MvcControlsToolkit_Parse(p, q), v, q); o = p } if (m == "select") { } else { a.value = p } if (MvcControlsToolkit_Validate(s, h) && !y) { $("#" + s).hide(); $("#" + A).show(); if (o == "") { if (g == "") { $("#" + A).html("&nbsp;&nbsp;&nbsp;") } else { $("#" + A).text(g) } if (l) { $("#" + A).attr("title", "") } } else { $("#" + A).text(n + o + u); if (l) { $("#" + A).attr("title", n + o + u) } } $("#" + s).trigger("TypedEditDisplay_Changed"); return true } else { $("#" + s).show(); $("#" + A).hide(); $("#" + s).trigger("TypedEditDisplay_Changed"); return false } } function MvcControlsToolkit_EditDisplayButton(m, f, c, h, l) { var j = $(m); var a = j.data("_editDisplayState_") || { display: false, jElements: j.parents(f).first().find("[data-element-type=TypedEditDisplay]") }; var g = j[0]; function e(o) { var n = true; o.each(function () { var p = { goneDisplay: false }; $(this).trigger("pblur", p); if (!p.goneDisplay) { n = false } }); return n } function d(p, o) { var n = p.tagName.toLowerCase(); if (n == "a") { $(p).text(o) } else { if (n == "img") { $(p).attr("src", o) } else { $(p).val(o) } } } function k(n) { n.each(function () { $("#" + $(this).attr("id") + "_display").trigger("pedit") }) } function b(o, n, p) { if (!p) { return } o.each(function () { p(this, n) }) } if (a.display) { k(a.jElements); d(g, c); a.display = false; b(a.jElements, "goneEdit", l) } else { res = e(a.jElements); if (res) { d(g, h); a.display = true; b(a.jElements, "goneDisplay", l) } else { k(a.jElements); b(a.jElements, "failedGoneEdit", l) } } $(g).data("_editDisplayState_", a) } function MvcControlsToolkit_TypedTextBox_BindChange(b, a) { $("#" + b + "_hidden").bind("TypedTextBox_Changed", a) } function MvcControlsToolkit_TypedTextBox_UnbindChange(b, a) { $("#" + b + "_hidden").unbind("TypedTextBox_Changed", a) } function MvcControlsToolkit_TypedEditDisplay_BindChange(b, a) { $("#" + b).bind("TypedEditDisplay_Changed", a) } function MvcControlsToolkit_TypedEditDisplay_UnbindChange(b, a) { $("#" + b).unbind("TypedEditDisplay_Changed", a) } function MvcControlsToolkit_TypedTextBox_SetString(b, a) { var b = $(b); b.trigger("pfocus"); b.val(a); b.trigger("pblur") } function MvcControlsToolkit_TypedInput_Load(a, b) { var b = $(b); b.trigger("pfocus"); b.val(a); b.trigger("pblur") } function MvcControlsToolkit_TypedTextBox_GetString(a) { var b = a.id.substring(0, a.id.lastIndexOf("_")); return $("#" + b).val() } function MvcControlsToolkit_TypedTextBox_Set(c, b, f, h) { var e = $(c); if (!h) { h = parseInt(e.attr("data-client-type")) } var d = c.id.substring(0, c.id.lastIndexOf("_")); var g = $("#" + d); if (g.length == 0) { var a = function () { MvcControlsToolkit_TypedTextBox_Set(c, b, f, h) }; setTimeout(a, 0); return } var b = MvcControlsToolkit_Format(b, f, h, "", ""); g.val(b); e.val(b); e.trigger("pfocus"); e.trigger("pblur") } function MvcControlsToolkit_TypedTextBox_SetById(f, a, c, e) { var b = $("#" + f + "_hidden"); if (!e) { e = parseInt(b.attr("data-client-type")) } var d = $("#" + f); var a = MvcControlsToolkit_Format(a, c, e, "", ""); d.val(a); b.val(a); b.trigger("pfocus"); b.trigger("pblur") } function MvcControlsToolkit_TypedTextBox_Get(a, c) { var b = a.id.substring(0, a.id.lastIndexOf("_")); return MvcControlsToolkit_Parse($("#" + b).val(), c) } function MvcControlsToolkit_TypedTextBox_GetById(b, a) { return MvcControlsToolkit_Parse($("#" + b).val(), a) } function MvcControlsToolkit_TypedEditDisplay_SetString(b, a) { var b = $(b); b.val(a); b.trigger("pblur") } function MvcControlsToolkit_TypedEditDisplay_GetString(a) { return $(a).val() } function MvcControlsToolkit_TypedEditDisplay_Set(b, a, d, e) { var c = $(b); if (!e) { e = parseInt(c.attr("data-client-type")) } $(b).val(MvcControlsToolkit_Format(a, d, e, "", "")); c.trigger("pblur") } function MvcControlsToolkit_TypedEditDisplay_SetById(e, a, c, d) { var b = $("#" + e); if (!d) { d = parseInt(b.attr("data-client-type")) } b.val(MvcControlsToolkit_Format(a, c, d, "", "")); b.trigger("pblur") } function MvcControlsToolkit_TypedEditDisplay_Get(a, b) { return MvcControlsToolkit_Parse($(a).val(), b) } function MvcControlsToolkit_TypedEditDisplay_GetById(b, a) { return MvcControlsToolkit_Parse($("#" + b).val(), a) } function MvcControlsToolkit_DisplayField_SetString(b, a) { return } function MvcControlsToolkit_DisplayField_GetString(a) { return $("#" + id).data("_True") } function MvcControlsToolkit_AjaxLink(c, b, d, a) { $.ajax({ type: "GET", url: c, success: function (e) { if (d == 0) { $("#" + b).html(e) } else { if (d == -1) { $("#" + b).before(e) } else { if (d == 1) { $("#" + b).after(e) } } } if (a) { a($("#" + b)) } } }) } function MvcControlsToolkit_AjaxSubmit(a, b) { if (!MvcControlsToolkit_FormIsValid(b, a)) { return } $("#" + b).parents("form").submit() } function MvcControlsToolkit_UpdateDropDownOptions(c, f, b, a, d, e) { $.getJSON(c, function (k) { var g = []; var h = function (n, m) { var l = null; if (typeof (a) == "function") { l = a(n) } else { l = a } g.push("<option value ='" + n + "' " + (l == null ? "" : "class = '" + l + "' ") + ">" + m + "</option>") }; var j = function (m, l, o) { var p = null; if (typeof (d) == "function") { p = d(o) } else { p = d } g.push("<optgroup label ='" + m + "' " + (p == null ? "" : "class = '" + p + "' ") + ">"); for (var n = 0; n < l.length; n++) { h(l[n].Value, l[n].Text) } g.push("</optgroup>") }; if (b != null) { h("", b) } $.each(k, function (l, m) { if ("Group" in m) { if ("Value" in m) { j(m.Text, m.Group, m.Value) } else { j(m.Text, m.Group, m.Text) } } else { h(m.Value, m.Text) } }); f.html(g.join("")); if (e != null && typeof (e) == "function") { e(f) } }) } $(document).ready(function () { $(document).on("mouseover", ".MvcControlsToolkit-Hover", function (a) { $(this).addClass("MvcControlsToolkit-Hover-On") }); $(document).on("mouseleave", ".MvcControlsToolkit-Hover", function (a) { if (a.target.tagName.toLowerCase() == "select") { return } $(this).removeClass("MvcControlsToolkit-Hover-On"); $(this).find("select").trigger("blur") }) }); var MvcControlsToolkit_ParseRegister = (function () { var a = []; var b = false; return { add: function (d, c) { a.push({ f: d, i: c }); if (c) { b = true } }, parse: function (c) { for (i = 0; i < a.length; i++) { a[i].f(c) } }, init: function () { if (b) { for (i = 0; i < a.length; i++) { if (a[i].i) { a[i].f() } } } } } })(); $(document).ready(function () { MvcControlsToolkit_ParseRegister.init() });